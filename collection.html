<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bon Idee Collective | Bon Idee</title>
  <meta name="description" content="The Bon Idee Collective. Stories, photos, and accomplishments from Bon Idee dogs and their people." />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="styles.css" />

  <style>
    /* Per-card photo carousel */
    .carousel {
      position: relative;
      border-radius: 16px;
      overflow: hidden;
      background: #0b0b0b;
      border: 1px solid rgba(255,255,255,0.08);
    }
    .carousel-track {
      display: flex;
      gap: 10px;
      padding: 10px;
      overflow-x: auto;
      overflow-y: hidden;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }
    .carousel-track::-webkit-scrollbar { display: none; }

    .carousel-item {
      flex: 0 0 86%;
      scroll-snap-align: start;
    }
    @media (min-width: 720px) {
      .carousel-item { flex-basis: 70%; }
    }
    @media (min-width: 980px) {
      .carousel-item { flex-basis: 60%; }
    }

    .carousel-item .img {
      position: relative;
      width: 100%;
      aspect-ratio: 16 / 10;
      border-radius: 14px;
      overflow: hidden;
      background: #000;
    }
    .carousel-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      transform: translateZ(0);
    }

    .carousel-nav {
      pointer-events: none;
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px;
    }
    .carousel-btn {
      pointer-events: auto;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.55);
      color: #fff;
      border-radius: 999px;
      width: 38px;
      height: 38px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      backdrop-filter: blur(6px);
    }
    .carousel-btn:active { transform: scale(0.98); }
    .carousel-btn[disabled] {
      opacity: 0.25;
      cursor: default;
    }

    /* Keep cards clean when only one image */
    .single-media {
      border-radius: 16px;
      overflow: hidden;
      background: #0b0b0b;
      border: 1px solid rgba(255,255,255,0.08);
    }
    .single-media .imgwrap img {
      width: 100%;
      height: auto;
      display: block;
    }
  </style>
</head>

<body>
 <header class="nav">
  <div class="container nav-inner">
    <a class="brand" href="index.html">Bon Idee</a>

    <nav class="links">
      <a href="index.html">Home</a>
      <a href="bouviers.html">Bouviers</a>
      <a href="lowchen.html">Lowchen</a>
      <a href="collection.html" aria-current="page">Bon Idee Collective</a>
      <a class="btn" href="index.html#contact">Inquire</a>
    </nav>
  </div>
</header>

  <main>
    <section class="hero">
      <div class="container hero-inner">
        <div class="hero-copy">
          <p class="kicker">The Bon Idee Collective</p>
          <h1>Our Dogs, Their People, Their Stories</h1>
          <p class="lead">
            A living timeline of Bon Idee dogs, their accomplishments, and the families who love them.
          </p>

          <div class="hero-actions" id="submit">
            <a class="btn" id="submitBtn" href="#" target="_blank" rel="noopener noreferrer">Submit a Story</a>
            <a class="btn ghost" href="#posts">View the Timeline</a>
          </div>

          <p class="small muted" style="margin-top:10px;">
            Submissions are reviewed before publishing.
          </p>
        </div>

        <div class="hero-media">
          <div class="media placeholder" style="background-image:url('./images/collective-hero.jpg'); background-size:cover; background-position:center;">
            <span>Optional hero image at<br><strong>/images/collective-hero.jpg</strong></span>
          </div>
          <div class="media-caption">
            <p class="small muted">
              Bon Idee Collective.
            </p>
          </div>
        </div>
      </div>
    </section>

    <section class="section" id="posts">
      <div class="container">
        <div class="section-head">
          <h2>Timeline</h2>
          <p class="muted">Newest stories appear first.</p>
        </div>

        <div id="collectiveStatus" class="panel" style="display:none;"></div>
        <div id="collectiveGrid" class="grid"></div>
      </div>
    </section>

    <div id="lightbox" class="lightbox" aria-hidden="true">
      <div class="lightbox-inner" role="dialog" aria-modal="true">
        <div class="lightbox-top">
          <div id="lightboxTitle" class="lightbox-title"></div>
          <button id="lightboxClose" class="lightbox-close" type="button">Close</button>
        </div>
        <img id="lightboxImg" alt="Bon Idee photo" />
      </div>
    </div>

    <footer class="footer">
      <div class="container footer-inner">
        <p class="small muted">© <span id="year"></span> Bon Idee</p>
        <p class="small muted"><a class="muted" href="./">Back to Home</a></p>
      </div>
    </footer>
  </main>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    // Paste your Google Form link here
    const SUBMIT_FORM_URL = "PASTE_YOUR_GOOGLE_FORM_LINK_HERE";

    // Apps Script JSONP endpoint
    const FEED_BASE = "https://script.google.com/macros/s/AKfycbzLj1H04WNOujMAeQWp6yG6Ne7ks_IY3ddE0SUwAabwsnFvWT1v_IbVuq08-FVIKIUfkQ/exec";

    document.getElementById("submitBtn").href = SUBMIT_FORM_URL;

    function esc(s) {
      return String(s || "").replace(/[&<>"']/g, (c) => ({
        "&": "&amp;",
        "<": "&lt;",
        ">": "&gt;",
        '"': "&quot;",
        "'": "&#39;",
      }[c]));
    }

    function showStatus(html) {
      const el = document.getElementById("collectiveStatus");
      el.style.display = "block";
      el.innerHTML = html;
    }

    function hideStatus() {
      const el = document.getElementById("collectiveStatus");
      el.style.display = "none";
      el.innerHTML = "";
    }

    function loadJsonp(url) {
      return new Promise((resolve, reject) => {
        const cb = "cb_" + Math.random().toString(36).slice(2);
        window[cb] = (data) => {
          cleanup();
          resolve(data);
        };

        function cleanup() {
          try { delete window[cb]; } catch (e) { window[cb] = undefined; }
          script.remove();
        }

        const script = document.createElement("script");
        script.src = url.replace("callback=cbTest", "callback=" + cb);
        script.onerror = () => {
          cleanup();
          reject(new Error("Failed to load JSONP."));
        };
        document.head.appendChild(script);
      });
    }

    function scrollCarousel(track, dir) {
      const card = track.querySelector(".carousel-item");
      const step = card ? (card.getBoundingClientRect().width + 10) : 320;
      track.scrollBy({ left: dir * step, behavior: "smooth" });
    }

    function renderMedia(p) {
      const photos = Array.isArray(p.photos) ? p.photos : [];
      const dog = esc(p.dog || "Bon Idee Dog");

      if (photos.length <= 1) {
        const cover = (p.cover && p.cover.thumb) ? p.cover.thumb : "";
        if (!cover) {
          return `<div class="card-media placeholder"><span>Photo pending</span></div>`;
        }
        const view = (p.cover && p.cover.view) ? p.cover.view : cover;
        return `
          <div class="single-media">
            <a href="${esc(view)}" class="lb-item" data-url="${esc(cover)}" data-title="${dog}">
              <div class="card-media imgwrap">
                <img loading="lazy" src="${esc(cover)}" alt="${dog}" />
              </div>
            </a>
          </div>
        `;
      }

      const itemsHtml = photos.map((ph, i) => {
        const thumb = ph.thumb || "";
        const view = ph.view || thumb;
        if (!thumb) return "";
        return `
          <div class="carousel-item">
            <a href="${esc(view)}" class="lb-item" data-url="${esc(thumb)}" data-title="${dog} (${i + 1}/${photos.length})">
              <div class="img">
                <img loading="lazy" src="${esc(thumb)}" alt="${dog} photo ${i + 1}" />
              </div>
            </a>
          </div>
        `;
      }).join("");

      return `
        <div class="carousel" data-carousel="1">
          <div class="carousel-track" data-track="1" aria-label="Photo carousel for ${dog}">
            ${itemsHtml}
          </div>
          <div class="carousel-nav">
            <button class="carousel-btn" type="button" data-prev="1" aria-label="Previous photos">‹</button>
            <button class="carousel-btn" type="button" data-next="1" aria-label="Next photos">›</button>
          </div>
        </div>
      `;
    }

    async function renderCollective() {
      const grid = document.getElementById("collectiveGrid");
      grid.innerHTML = "";
      showStatus("<h3>Loading...</h3><p class='small muted'>Fetching latest posts.</p>");

      try {
        const url = `${FEED_BASE}?key=collection&limit=120&callback=cbTest`;
        const data = await loadJsonp(url);

        if (!data || !data.ok) {
          showStatus(`<h3>Collective unavailable</h3><p class="small muted">${esc((data && data.error) || "Unknown error.")}</p>`);
          return;
        }

        const items = (data.items || []);
        if (!items.length) {
          showStatus(`
            <h3>No stories published yet</h3>
            <p class="small muted">Submissions are reviewed before publishing. Be the first to submit a story.</p>
            <a class="btn" href="${esc(SUBMIT_FORM_URL)}" target="_blank" rel="noopener noreferrer">Submit a Story</a>
          `);
          return;
        }

        hideStatus();

        grid.innerHTML = items.map((p) => {
          const dog = esc(p.dog || "Bon Idee Dog");
          const owner = esc(p.owner || "");
          const breed = esc(p.breed || "");
          const story = esc(p.story || "");

          const metaParts = [];
          if (owner) metaParts.push(`Owner: ${owner}`);
          if (breed) metaParts.push(breed);
          const meta = metaParts.join(" · ");

          return `
            <article class="card">
              ${renderMedia(p)}
              <div class="card-body">
                <h3>${dog}</h3>
                ${meta ? `<p class="small muted">${esc(meta)}</p>` : ""}
                ${story ? `<p style="margin-top:10px;">${story}</p>` : ""}
              </div>
            </article>
          `;
        }).join("");

        hookCarousels();
        hookLightbox();
      } catch (e) {
        showStatus(`<h3>Collective unavailable</h3><p class="small muted">${esc(e.message || e)}</p>`);
      }
    }

    function hookCarousels() {
      document.querySelectorAll(".carousel").forEach(carousel => {
        const track = carousel.querySelector(".carousel-track");
        const prev = carousel.querySelector("[data-prev]");
        const next = carousel.querySelector("[data-next]");
        if (!track || !prev || !next) return;

        prev.addEventListener("click", () => scrollCarousel(track, -1));
        next.addEventListener("click", () => scrollCarousel(track, 1));

        track.addEventListener("wheel", (e) => {
          if (Math.abs(e.deltaX) > Math.abs(e.deltaY)) return;
          if (!e.shiftKey) return;
          e.preventDefault();
          track.scrollLeft += e.deltaY;
        }, { passive: false });
      });
    }

    function hookLightbox() {
      const lightbox = document.getElementById("lightbox");
      const lbImg = document.getElementById("lightboxImg");
      const lbTitle = document.getElementById("lightboxTitle");
      const lbClose = document.getElementById("lightboxClose");
      const grid = document.getElementById("collectiveGrid");

      function openLightbox(url, title) {
        lbImg.src = url;
        lbTitle.textContent = title || "";
        lightbox.classList.add("open");
        lightbox.setAttribute("aria-hidden", "false");
        document.body.style.overflow = "hidden";
      }

      function closeLightbox() {
        lightbox.classList.remove("open");
        lightbox.setAttribute("aria-hidden", "true");
        lbImg.src = "";
        document.body.style.overflow = "";
      }

      grid.addEventListener("click", (e) => {
        const a = e.target.closest(".lb-item");
        if (!a) return;
        e.preventDefault();
        openLightbox(a.dataset.url, a.dataset.title);
      });

      lbClose.addEventListener("click", closeLightbox);

      lightbox.addEventListener("click", (e) => {
        if (e.target === lightbox) closeLightbox();
      });

      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") closeLightbox();
      });
    }

    renderCollective();
  </script>
</body>
</html>
